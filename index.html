<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Neaspace WhatsApp Access</title>
<meta name="robots" content="noindex,nofollow">
<meta name="googlebot" content="noindex,nofollow">
<style>
  :root{--fg:#111;--muted:#666;--ok:#0a6800;--err:#b00020;--btn:#007bff;--btnH:#0056b3}
  body{margin:0;font:500 16px/1.5 system-ui,-apple-system,"Segoe UI",Roboto,Arial,sans-serif;color:var(--fg)}
  .wrap{max-width:680px;margin:0 auto;padding:28px 16px}
  h1{font-size:20px;margin:0 0 12px}
  .card{border:1px solid #eee;border-radius:12px;padding:18px;margin-top:12px;box-shadow:0 2px 6px rgba(0,0,0,.06)}
  .muted{color:var(--muted);font-size:14px}
  .ok{color:var(--ok);font-weight:700}
  .err{color:var(--err);font-weight:700}
  .btn{display:inline-block;padding:10px 18px;border-radius:8px;background:var(--btn);color:#fff;text-decoration:none;font-weight:700}
  .btn:hover{background:var(--btnH)}
  .btn[aria-disabled="true"]{opacity:.6;pointer-events:none}
  .row{margin:6px 0}
  code{background:#f6f6f6;border:1px solid #eee;border-radius:6px;padding:2px 6px}
</style>
</head>
<body>
  <div class="wrap">
    <h1 id="title">Neaspace WhatsApp Access</h1>
    <div class="card" id="panel">
      <div class="row muted" id="checking">Verifying your stay window…</div>
    </div>
  </div>

<script>
(function(){
  // ---------- i18n ----------
  const messages = {
    en: {
      title: "Neaspace WhatsApp Access",
      checking: "Verifying your stay window…",
      missing: "Dates missing.",
      need: "This page needs ?arrival=DD.MM.YY (or YYYY-MM-DD / MM/DD/YYYY) and &departure=…",
      stay: "Stay window",
      today: "Today",
      granted: "Access granted for today.",
      denied: "Access denied outside your stay dates.",
      info: "WhatsApp is enabled only between the dates above.",
      btn: "Open WhatsApp",
      btnDisabled: "WhatsApp (disabled)",
      alert: "⚠️ WhatsApp access is only allowed between your arrival and departure dates."
    },
    it: {
      title: "Accesso WhatsApp Neaspace",
      checking: "Verifica delle date di soggiorno…",
      missing: "Date mancanti.",
      need: "Questa pagina richiede ?arrival=GG.MM.AA (oppure YYYY-MM-DD / MM/DD/YYYY) e &departure=…",
      stay: "Periodo di soggiorno",
      today: "Oggi",
      granted: "Accesso consentito per oggi.",
      denied: "Accesso negato fuori dalle date di soggiorno.",
      info: "WhatsApp è abilitato solo tra le date sopra indicate.",
      btn: "Apri WhatsApp",
      btnDisabled: "WhatsApp (disabilitato)",
      alert: "⚠️ L’accesso a WhatsApp è consentito solo tra le date di soggiorno."
    },
    fr: {
      title: "Accès WhatsApp Neaspace",
      checking: "Vérification de vos dates de séjour…",
      missing: "Dates manquantes.",
      need: "Cette page nécessite ?arrival=JJ.MM.AA (ou YYYY-MM-DD / MM/DD/YYYY) et &departure=…",
      stay: "Période de séjour",
      today: "Aujourd’hui",
      granted: "Accès autorisé pour aujourd’hui.",
      denied: "Accès refusé en dehors des dates de séjour.",
      info: "WhatsApp est activé uniquement entre les dates ci-dessus.",
      btn: "Ouvrir WhatsApp",
      btnDisabled: "WhatsApp (désactivé)",
      alert: "⚠️ L’accès WhatsApp est uniquement autorisé entre vos dates de séjour."
    },
    es: {
      title: "Acceso WhatsApp Neaspace",
      checking: "Verificando tus fechas de estancia…",
      missing: "Faltan fechas.",
      need: "Esta página requiere ?arrival=DD.MM.AA (o YYYY-MM-DD / MM/DD/YYYY) y &departure=…",
      stay: "Periodo de estancia",
      today: "Hoy",
      granted: "Acceso permitido para hoy.",
      denied: "Acceso denegado fuera de tus fechas de estancia.",
      info: "WhatsApp solo está habilitado entre las fechas indicadas.",
      btn: "Abrir WhatsApp",
      btnDisabled: "WhatsApp (deshabilitado)",
      alert: "⚠️ El acceso a WhatsApp solo está permitido entre tus fechas de estancia."
    }
  };

  function detectLang(){
    const lang = (navigator.language || 'en').slice(0,2);
    if(messages[lang]) return lang;
    return 'en';
  }
  const lang = detectLang();
  const msg = messages[lang];
  document.getElementById('title').innerText = msg.title;
  document.getElementById('checking').innerText = msg.checking;

  
  const n1 = ['39','328','388','7637'];  // numero a pezzi
  const TO = n1.join('');
  const tA = ['#Neaspace','19Rue','Neuve']; // testo a pezzi
  const TEXT = tA.join('');

  const TZ = 'Europe/Paris';

  
  const qs = new URLSearchParams(location.search);
  const arrivalStr   = qs.get('arrival')   || qs.get('checkin');
  const departureStr = qs.get('departure') || qs.get('checkout');

  function toFourDigitYear(yy){ yy=+yy; return yy<70?2000+yy:1900+yy; }

  function parseFlexibleDate(s){
    if(!s) return null; s=String(s).trim(); let m;
    if((m=s.match(/^(\d{4})-(\d{2})-(\d{2})(?:T.*)?$/))){return new Date(Date.UTC(+m[1],+m[2]-1,+m[3]));}
    if((m=s.match(/^(\d{2})\.(\d{2})\.(\d{2}|\d{4})$/))){const d=+m[1],mo=+m[2]-1,y=(m[3].length===2?toFourDigitYear(m[3]):+m[3]);return new Date(Date.UTC(y,mo,d));}
    if((m=s.match(/^(\d{1,2})\/(\d{1,2})\/(\d{2}|\d{4})$/))){let a=+m[1],b=+m[2],y=(m[3].length===2?toFourDigitYear(m[3]):+m[3]);let d,mo;if(a>12&&b<=12){d=a;mo=b-1;}else if(b>12&&a<=12){d=b;mo=a-1;}else{d=b;mo=a-1;}return new Date(Date.UTC(y,mo,d));}
    return null;
  }

  function iso(d){return `${d.getUTCFullYear()}-${String(d.getUTCMonth()+1).padStart(2,'0')}-${String(d.getUTCDate()).padStart(2,'0')}`;}
  function todayInTZ(tz){const p=new Intl.DateTimeFormat('en-CA',{timeZone:tz,year:'numeric',month:'2-digit',day:'2-digit'}).formatToParts(new Date());const y=p.find(x=>x.type==='year').value,m=p.find(x=>x.type==='month').value,d=p.find(x=>x.type==='day').value;return parseFlexibleDate(`${y}-${m}-${d}`);}
  function within(t,a,d){return !!(t&&a&&d)&&t>=a&&t<=d;}

  // ---------- UI ----------
  const panel=document.getElementById('panel');
  function line(html,cls='row'){const div=document.createElement('div');div.className=cls;div.innerHTML=html;return div;}

  const a=parseFlexibleDate(arrivalStr);
  const d=parseFlexibleDate(departureStr);
  const t=todayInTZ(TZ);

  if(!a||!d){
    panel.innerHTML='';
    panel.append(line(`<span class="err">${msg.missing}</span>`));
    panel.append(line(msg.need,'muted'));
    return;
  }

  const allowed=within(t,a,d);
  panel.innerHTML='';
  panel.append(line(`${msg.stay}: <code>${iso(a)}</code> → <code>${iso(d)}</code>`,'muted'));
  panel.append(line(`${msg.today}: <code>${iso(t)}</code>`,'muted'));

  if(allowed){
    panel.append(line(msg.granted,'ok'));
    const url=`https://wa.me/${TO}?text=${encodeURIComponent(TEXT)}`;
    const aEl=document.createElement('a');aEl.className='btn';aEl.href=url;aEl.rel='noopener';aEl.textContent=msg.btn;
    panel.append(line(aEl.outerHTML));
    location.href=url; // redirect immediato
  }else{
    alert(msg.alert);
    panel.append(line(`<span class="err">${msg.denied}</span>`));
    panel.append(line(msg.info,'muted'));
    const aEl=document.createElement('a');aEl.className='btn';aEl.setAttribute('aria-disabled','true');aEl.textContent=msg.btnDisabled;
    panel.append(line(aEl.outerHTML));
  }
})();
</script>
</body>
</html>
